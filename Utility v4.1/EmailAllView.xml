<?xml version="1.0" encoding="utf-8"?>
  <DataView  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:dsp="http://www.gappex.com/sfp/DataSource/Parameters" Ident="EmailAllView" SegmentType="Admin" TitleResourceKey="EmailAllView_Utility" GroupTitleResourceKey="UtilityGroup" Priority="60" PackageIdent="Utility">
  <AccessPermissions>
    <string>SuperAdmin</string>
  </AccessPermissions>
  <DataSource>
		<Columns>
			<Column Ident="ID" TitleResourceKey="ID_Utility" IsPrimaryKey="true" Width="5" IsVisible="true" />
      <Column Ident="BasicInfo" TitleResourceKey="BasicInfo_Utility" Width="30" />
      <Column Ident="Email" TitleResourceKey="Email_Utility" Width="65" />
		</Columns>
		<SQL>
      SELECT TOP (100)
        ema.ID
        ,CONCAT(
          '<table>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'FromEmail_Utility' AND LanguageID = @UserLanguageID), 'FromEmail')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.FromEmail, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'FromName_Utility' AND LanguageID = @UserLanguageID), 'FromName')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.FromName, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'ToEmail_Utility' AND LanguageID = @UserLanguageID), 'ToEmail')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.ToEmail, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'CreateDate_Utility' AND LanguageID = @UserLanguageID), 'CreateDate')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.CreateDate, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'SendDate_Utility' AND LanguageID = @UserLanguageID), 'SendDate')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.SendDate, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'State_Utility' AND LanguageID = @UserLanguageID), 'State')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.State, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'Count_Utility' AND LanguageID = @UserLanguageID), 'Count')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.Count, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'Error_Utility' AND LanguageID = @UserLanguageID), 'Error')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.Error, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'BCC_Utility' AND LanguageID = @UserLanguageID), 'BCC')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.BCC, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'CC_Utility' AND LanguageID = @UserLanguageID), 'CC')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.CC, '</td></tr>'
            ,'<tr style="background-color: transparent;"><td style="padding: 0.1rem 1rem;">'
              ,ISNULL((SELECT TOP 1 [Value] FROM dbo.[Resource] WHERE [Key] = 'Priority_Utility' AND LanguageID = @UserLanguageID), 'Priority')
            ,'</td><td style="padding: 0.1rem 1rem; word-wrap: break-word;">', ema.Priority, '</td></tr>'
          ,'</table>'
        ) AS BasicInfo
        ,CONCAT(
          '<div onclick="var emMod=document.createElement(''DIV''),cpMail=this.cloneNode(!0);cpMail.removeAttribute(''onclick''),emMod.appendChild(cpMail),emMod.style.position=''fixed'',emMod.style.height=''100vh'',emMod.style.width=''100vw'',emMod.style.top=''0'',emMod.style.left=''0'',emMod.style.backgroundColor=''white'',emMod.style.zIndex=''200'',emMod.style.padding=''1rem'',emMod.setAttribute(''onclick'',''this.parentNode.removeChild(this)''),document.getElementsByTagName(''html'')[0].append(emMod);">'
            ,'<b>', ema.Subject , '</b><br/><hr/>'
            ,REPLACE(ema.Body, '<img', '<img loading="lazy"')
          ,'</div>'
        ) AS Email
      FROM dbo.Email AS ema
      ORDER BY ID DESC
      
    </SQL>
    <Parameters>
      <dsp:Parameter xsi:type="dsp:VariableParameter" ConstantType="UserLanguageID" Ident="UserLanguageID" DataType="Number" />
    </Parameters>
	</DataSource>
</DataView>